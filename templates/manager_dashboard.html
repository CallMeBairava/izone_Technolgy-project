<!DOCTYPE html>
<html>
<head>
    <title>Admin CRM Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
<div class="background-shape"></div>

<div class="admin-portal">

    <!-- ================= SIDEBAR ================= -->
    <div class="admin-sidebar">
        <h2>Manager Dashboard</h2>

        <a href="/admin_dashboard" class="active">üìä Dashboard</a>
        <a href="/employees">Employees</a>

        <!-- ‚úÖ Scroll Sections -->
        <a href="#completed">‚úÖ Completed Works</a>
        <a href="#pending">‚è≥ Pending Works</a>
        <a href="#reassign">üîÑ Reassign Works</a>

        <a href="/logout">Logout</a>
    </div>

    <!-- ================= MAIN CONTENT ================= -->
    <div class="admin-main">

        <!-- ================= TOP NAVBAR ================= -->
        <div class="admin-navbar">
            <h1>Manager CRM Portal</h1>
            
        </div>

        <!-- ================= DASHBOARD CARDS ================= -->
        <div class="admin-cards">
            <div class="admin-card blue">
                <h3>Total Customers</h3>
                <p>{{ customers|length }}</p>
            </div>

            <div class="admin-card green">
                <h3>Total Employees</h3>
                <p>{{ employees|length }}</p>
            </div>

            <div class="admin-card orange">
                <h3>Total Teams</h3>
                <p>{{ teams|length }}</p>
            </div>
        </div>

        <!-- ================= ADD EMPLOYEE ================= -->
        <div class="admin-box">
            <h3>‚ûï Add Employee</h3>

            <form method="POST" action="/add_employee">
                <input type="text" name="name" placeholder="Employee Name" required>
                <input type="text" name="phone" placeholder="Phone Number" required>
                <input type="text" name="username" placeholder="Login Username" required>
                <input type="password" name="password" placeholder="Login Password" required>

                <button type="submit">Add Employee</button>
            </form>
        </div>

        <!-- ================= ADD CUSTOMER ================= -->
        <div class="admin-box">
            <h3>‚ûï Add Customer Manually</h3>

            <form method="POST" action="/add_customer">
                <input type="text" name="cust_name" placeholder="Customer Name" required>
                <input type="text" name="cust_phone" placeholder="Customer Phone" required>
                <input type="email" name="cust_email" placeholder="Customer Email" required>

                <select name="cust_gender" required>
                    <option value="">-- Select Gender --</option>
                    <option>Male</option>
                    <option>Female</option>
                    <option>Other</option>
                </select>

                <input type="text" name="cust_address" placeholder="Customer Address" required>

                <button type="submit">Add Customer</button>
            </form>
        </div>

        <!-- ================= EXCEL UPLOAD ================= -->
<!-- ================= EXCEL UPLOAD + AUTO DISTRIBUTION ================= -->
<div class="admin-box">
    <h3>üìÇ Upload Customers via Excel (Auto Assign)</h3>

    <form method="POST" action="/upload_customers" enctype="multipart/form-data">

        <!-- Select Team -->
        <select name="team_id" required>
            <option value="">-- Select Team for Auto Distribution --</option>
            {% for t in teams %}
            <option value="{{ t[0] }}">{{ t[1] }}</option>
            {% endfor %}
        </select>

        <!-- Upload File -->
        <input type="file" name="file" required>

        <button type="submit">Upload & Auto Assign</button>
    </form>
</div>


        <!-- ================= TEAM MANAGEMENT ================= -->
        <div class="admin-box">
            <h3>üë• Team Management</h3>

            <form method="POST" action="/create_team">
                <input type="text" name="team_name" placeholder="Enter Team Name" required>
                <button type="submit">+ Create Team</button>
            </form>

            <hr style="margin:20px 0;">

            <form method="POST" action="/add_team_member">

                <select name="team_id" required>
                    <option value="">-- Select Team --</option>
                    {% for t in teams %}
                    <option value="{{ t[0] }}">{{ t[1] }}</option>
                    {% endfor %}
                </select>

                <select name="employee_id" required>
                    <option value="">-- Select Employee --</option>
                    {% for e in employees %}
                    <option value="{{ e[0] }}">{{ e[1] }}</option>
                    {% endfor %}
                </select>

                <button type="submit">Assign Employee</button>
            </form>
        </div>

        <!-- ================= ASSIGN CUSTOMERS TO TEAM ================= -->
        <div class="admin-box">
            <h3>üìå Assign Customers to Team</h3>

            <form method="POST" action="/assign_team_customers">

                <select name="team_id" required>
                    <option value="">-- Select Team --</option>
                    {% for t in teams %}
                    <option value="{{ t[0] }}">{{ t[1] }}</option>
                    {% endfor %}
                </select>

                <p style="margin-top:15px; font-weight:600;">
                    Select Customers:
                </p>

                <div class="customer-checkbox-list">
                    {% for c in customers %}
                    <label class="check-item">
                        <input type="checkbox" name="customer_ids" value="{{ c[0] }}">
                        {{ c[1] }} ({{ c[2] }})
                    </label>
                    {% endfor %}
                </div>

                <button type="submit" class="btn assign-btn">
                    ‚úÖ Assign Selected Customers
                </button>

            </form>
        </div>

        <!-- ================= CUSTOMER LIST ================= -->
        <div class="admin-box">
            <h3>üìã Customer List</h3>

            <table>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Status</th>
                </tr>

                {% for c in customers %}
                <tr>
                    <td>{{ c[0] }}</td>
                    <td>{{ c[1] }}</td>
                    <td>{{ c[2] }}</td>
                    <td><b>{{ c[6] }}</b></td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <!-- ================= COMPLETED WORKS ================= -->
        <div class="admin-box" id="completed">
            <h3>‚úÖ Completed Works</h3>

            <table>
                <tr>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Status</th>
                </tr>

                {% for c in customers %}
                {% if c[6] == "Willing" %}
                <tr>
                    <td>{{ c[1] }}</td>
                    <td>{{ c[2] }}</td>
                    <td><b style="color:green;">{{ c[6] }}</b></td>
                </tr>
                {% endif %}
                {% endfor %}
            </table>
        </div>

        <!-- ================= PENDING WORKS ================= -->
        <div class="admin-box" id="pending">
            <h3>‚è≥ Pending Works</h3>

            <table>
                <tr>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Status</th>
                </tr>

                {% for c in customers %}
                {% if c[6] == "Pending" %}
                <tr>
                    <td>{{ c[1] }}</td>
                    <td>{{ c[2] }}</td>
                    <td><b style="color:orange;">{{ c[6] }}</b></td>
                </tr>
                {% endif %}
                {% endfor %}
            </table>
        </div>

        <!-- ================= REASSIGN WORKS ================= -->
        <div class="admin-box" id="reassign">
            <h3>üîÑ Reassign Customer</h3>

            <form method="POST" action="/reassign_customer">

                <select name="customer_id" required>
                    <option value="">-- Select Customer --</option>
                    {% for c in customers %}
                    <option value="{{ c[0] }}">{{ c[1] }}</option>
                    {% endfor %}
                </select>

                <select name="team_id" required>
                    <option value="">-- Select New Team --</option>
                    {% for t in teams %}
                    <option value="{{ t[0] }}">{{ t[1] }}</option>
                    {% endfor %}
                </select>

                <button type="submit">üîÅ Reassign</button>
            </form>
        </div>

        <!-- ================= CLEAR CALL HISTORY ================= -->
        <div class="admin-box">
            <h3>üßπ Call History Management</h3>

            <form method="POST" action="/clear_history">
                <button type="submit" class="danger-btn">
                    ‚ùå Clear All Call History
                </button>
            </form>
        </div>

    </div>
</div>

</body>
</html>
